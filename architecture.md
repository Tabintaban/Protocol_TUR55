# Архитектура протокола TUR55 v2.0

## Общая архитектура

```
┌─────────────────────────────────────────────┐
│                    Протокол TUR55 v2.0                      │
├─────────────────────────────────────┤
│ ┌─────────────────┐  ┌─────────────────┐  ┌──────────────┐ │
│  │   Блокчейны     │  │   Адаптеры      │  │   Сессии     │ │
│  │                 │  │ Блокчейнов      │  │              │ │
│  │ • Ethereum      │  │                 │  │ • Сессионные │ │
│ │ • Solana        │  │ • Ethereum      │  │   файлы      │ │
│  │ • Cosmos        │  │ • Solana        │  │ • Правила    │ │
│  │ • Polkadot      │  │ • Cosmos        │  │ • Валидация  │ │
│  │ • IOTA          │  │ • Polkadot      │  │              │ │
│  │ • др.           │  │ • IOTA          │  │              │ │
│  └─────────────────┘  │ • др.           │  └──────────────┘ │
│                       └─────────────────┘                   │
└─────────────────────────────────────────────────────────────┘
```

## Компоненты системы

### 1. Универсальный адаптер блокчейна (Blockchain Adapter)

```typescript
interface IBlockchainAdapter {
  // Универсальный интерфейс
  mintLicense(owner: string, techSpecs: TechSpecs): Promise<LicenseId>;
  verifyLicense(licenseId: LicenseId, user: string): Promise<boolean>;
  payRoyalty(amount: number, royaltyAddress: string): Promise<Transaction>;
  getLicenseData(licenseId: LicenseId): Promise<LicenseData>;
}
```

### 2. Универсальный формат лицензионного токена

```json
{
  "tur55License": {
    "version": "2.0",
    "licenseId": "chain://ethereum/0x123.../token/456",
    "owner": "chain://solana/ABC123...",
    "vehiclePublicKey": "ed25519:abc...",
    "techSpecs": {
      "vin": "XYZ123456789",
      "maxFuelLiters": 60,
      "engineType": "hybrid",
      "canBusVersion": "2.0"
    },
    "metadataURI": "ipfs://QmTechSpecsHash",
    "signature": "multichain://..."
  }
}
```

### 3. Формат сессионного файла

```json
{
  "protocol": "TUR55 v2.0",
  "license": {
    "id": "multichain://chain/address/token/id",
    "chainId": "ethereum:1",
    "verificationProof": "tx:0xabc123..."
  },
  "session": {
    "type": "fuel_based",
    "limit": 50.5,
    "rules": {
      "maxSpeed": 120,
      "validFrom": "2024-01-15T10:00:00Z",
      "validUntil": "2024-01-17T10:00:00Z"
    }
  },
  "crypto": {
    "vehiclePublicKey": "ed25519:abc...",
    "encryptedSessionKey": "ecies:...",
    "founderSignature": "signature:...",
    "hash": "sha3-256:..."
  }
}
```

## Многоуровневая архитектура

```
┌─────────────────────────────────────────────────────────────┐
│                    Уровень приложений                        │
│  (Кошельки, DApps, IoT устройства, мобильные приложения)    │
├─────────────────────────────────────────────────────────────┤
│                    Уровень сессий                           │
│ (Сессионные файлы, правила доступа, валидация)            │
├─────────────────────────────────────┤
│                   Уровень адаптеров                         │
│  (Интерфейсы блокчейнов, универсальные вызовы)              │
├─────────────────────────────────────────────────────────────┤
│                   Уровень блокчейнов                        │
│ (Ethereum, Solana, Cosmos, Polkadot и др.)                 │
└─────────────────────────────────────────────────────────────┘
```

## Потоки данных

1. **Создание лицензии**:
   - Владелец запрашивает создание лицензии
   - Адаптер блокчейна создает токен с техническими характеристиками
   - Техданные сохраняются в токене или в децентрализованном хранилище

2. **Использование лицензии**:
   - Сессионный файл создается с правилами доступа
   - Валидация лицензии на выбранном блокчейне
   - Проверка соответствия правил теххарактеристикам

3. **Межцепочечные операции**:
   - Перенос лицензий между блокчейнами
   - Универсальная идентификация через формат tur55://
   - Механизмы миграции и синхронизации

## Безопасность

- Криптографические подписи для верификации
- Зашифрованные сессионные ключи
- Универсальные проверки подлинности
- Защита от подделки лицензий